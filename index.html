<!DOCTYPE html>
<html>
<head>
    <title>AI Smart Soil Analysis</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .box { border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #f9f9f9; }
        h2 { color: #2e7d32; }
        #result { font-weight: bold; font-size: 1.2em; color: #d32f2f; margin-top: 10px;}
        button { background: #2e7d32; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; border-radius: 5px;}
        button:hover { background: #1b5e20; }
        .data-item { margin-bottom: 5px; }
    </style>
</head>
<body onload="fetchAndAnalyze()"> <div class="box">
        <h2>üå± AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å IoT...</p>
        
        <div id="sensor-display">
            ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
        </div>

        <br>
        <button onclick="fetchAndAnalyze()">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà</button>
        
        <p>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</p>
        <div id="result">-</div>
    </div>

    <script>
        // *** 1. ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ CSV URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà Google Sheet ***
        const CSV_URL = '‡πÉ‡∏™‡πà CSV URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà (Publish to web) ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà'; 

        // 2. ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Phase 1: Colab)
        const cropNames = ['Durian', 'Rice', 'Rubber']; // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏´‡∏≤‡∏Å Colab ‡∏ö‡∏≠‡∏Å ['Durian', 'Rice', 'Rubber']

        // ------------------------------------------------------------------------
        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô AI (‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Python)
        // ------------------------------------------------------------------------
        function score(input) {
function score(input) {
    var var0;
    if (input[3] <= 92.5) {
        if (input[5] <= 36.0) {
            var0 = [0.0, 0.0, 1.0];
        } else {
            var0 = [0.0, 1.0, 0.0];
        }
    } else {
        var0 = [1.0, 0.0, 0.0];
    }
    var var1;
    if (input[7] <= 25.5) {
        var1 = [0.0, 1.0, 0.0];
    } else {
        if (input[2] <= 6000.0) {
            var1 = [1.0, 0.0, 0.0];
        } else {
            var1 = [0.0, 0.0, 1.0];
        }
    }
    var var2;
    if (input[7] <= 26.0) {
        var2 = [0.0, 1.0, 0.0];
    } else {
        if (input[3] <= 55.0) {
            var2 = [0.0, 0.0, 1.0];
        } else {
            var2 = [1.0, 0.0, 0.0];
        }
    }
    var var3;
    if (input[5] <= 35.0) {
        var3 = [0.0, 0.0, 1.0];
    } else {
        if (input[8] <= 31.0) {
            var3 = [0.0, 1.0, 0.0];
        } else {
            var3 = [1.0, 0.0, 0.0];
        }
    }
    var var4;
    if (input[8] <= 31.5) {
        var4 = [0.0, 1.0, 0.0];
    } else {
        if (input[8] <= 34.0) {
            var4 = [1.0, 0.0, 0.0];
        } else {
            var4 = [0.0, 0.0, 1.0];
        }
    }
    var var5;
    if (input[2] <= 4750.0) {
        var5 = [1.0, 0.0, 0.0];
    } else {
        if (input[5] <= 36.0) {
            var5 = [0.0, 0.0, 1.0];
        } else {
            var5 = [0.0, 1.0, 0.0];
        }
    }
    var var6;
    if (input[5] <= 71.0) {
        if (input[5] <= 33.5) {
            var6 = [0.0, 0.0, 1.0];
        } else {
            var6 = [0.0, 1.0, 0.0];
        }
    } else {
        var6 = [1.0, 0.0, 0.0];
    }
    var var7;
    if (input[0] <= 77.5) {
        if (input[3] <= 55.0) {
            var7 = [0.0, 0.0, 1.0];
        } else {
            var7 = [1.0, 0.0, 0.0];
        }
    } else {
        var7 = [0.0, 1.0, 0.0];
    }
    var var8;
    if (input[2] <= 7000.0) {
        if (input[5] <= 70.0) {
            var8 = [0.0, 1.0, 0.0];
        } else {
            var8 = [1.0, 0.0, 0.0];
        }
    } else {
        var8 = [0.0, 0.0, 1.0];
    }
    var var9;
    if (input[6] <= 5.799999952316284) {
        var9 = [0.0, 0.0, 1.0];
    } else {
        if (input[5] <= 75.0) {
            var9 = [0.0, 1.0, 0.0];
        } else {
            var9 = [1.0, 0.0, 0.0];
        }
    }
    return mulVectorNumber(addVectors(addVectors(addVectors(addVectors(addVectors(addVectors(addVectors(addVectors(addVectors(var0, var1), var2), var3), var4), var5), var6), var7), var8), var9), 0.1);
}
function addVectors(v1, v2) {
    var result = new Array(v1.length);
    for (var i = 0; i < v1.length; i++) {
        result[i] = v1[i] + v2[i];
    }
    return result;
}
function mulVectorNumber(v1, num) {
    var result = new Array(v1.length);
    for (var i = 0; i < v1.length; i++) {
        result[i] = v1[i] * num;
    }
    return result;
}

==============================
‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏∑‡∏≠: ['Durian' 'Rice' 'Rubber']

        
            return [0, 0, 0]; 
        }

        // ------------------------------------------------------------------------
        // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
        // ------------------------------------------------------------------------
        async function fetchAndAnalyze() {
            document.getElementById("result").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
            document.getElementById("sensor-display").innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Google Sheets...";

            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV
                const response = await fetch(https://docs.google.com/spreadsheets/d/e/2PACX-1vRSLIE-xwPr0kFUfTKWatQMG6YXAswXoXnXn5jtS9A9T1XlZPMRHhxjok2BkTQAWbX2CuvNhrW9Yimn/pub?output=csv);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                
                // ‡πÅ‡∏õ‡∏•‡∏á CSV ‡πÄ‡∏õ‡πá‡∏ô Array of Rows
                const rows = csvText.trim().split('\n');
                
                // ‡πÅ‡∏ñ‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å IoT (‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠ Header)
                const latestRow = rows[rows.length - 1]; 
                const values = latestRow.split(',');

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ 9 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ AI)
                // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏ô Phase 1:
                // Hum_Soil(1), Hum_Air(2), Light(3), N(4), P(5), K(6), pH(7), Temp_Soil(8), Temp_Air(9)
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Float)
                const currentData = [
                    parseFloat(values[0]), // humidity of soil
                    parseFloat(values[1]), // humidity of air
                    parseFloat(values[2]), // intensity of light (LUX)
                    parseFloat(values[3]), // Nitrogen (N)
                    parseFloat(values[4]), // Phosphorus (P)
                    parseFloat(values[5]), // Potassium (K)
                    parseFloat(values[6]), // pH of soil
                    parseFloat(values[7]), // Temperature of soil
                    parseFloat(values[8])  // Temperature of Air
                ];

                // --- ‡πÉ‡∏´‡πâ AI ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå ---
                let probabilities = score(currentData);
                
                // ‡∏´‡∏≤‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                let maxIndex = probabilities.indexOf(Math.max(...probabilities));
                let resultCrop = cropNames['Durian' 'Rice' 'Rubber'];

                // --- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ---
                
                // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ Sensor ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                document.getElementById("sensor-display").innerHTML = `
                    <div class="data-item"><strong>NPK:</strong> ${currentData[3]}-${currentData[4]}-${currentData[5]} | <strong>pH:</strong> ${currentData[6]}</div>
                    <div class="data-item"><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô/‡∏≠‡∏≤‡∏Å‡∏≤‡∏®:</strong> ${currentData[0]}% / ${currentData[1]}%</div>
                    <div class="data-item"><strong>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏î‡∏¥‡∏ô/‡∏≠‡∏≤‡∏Å‡∏≤‡∏®:</strong> ${currentData[7]}¬∞C / ${currentData[8]}¬∞C | <strong>‡πÅ‡∏™‡∏á:</strong> ${currentData[2]} LUX</div>
                `;

                // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå
                document.getElementById("result").innerText = "‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡∏±‡∏ö: " + resultCrop;
                
            } catch (error) {
                console.error("Error fetching or processing data:", error);
                document.getElementById("result").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CSV URL ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Publish to web)";
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î (onload="fetchAndAnalyze()")

    </script>
</body>
</html>
